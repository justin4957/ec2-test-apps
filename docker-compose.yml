version: '3.8'

services:
  slogan-server:
    build:
      context: ./slogan-server
      dockerfile: Dockerfile
    ports:
      - "8080:8080"
    networks:
      - ec2-test-network
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:8080/health"]
      interval: 10s
      timeout: 3s
      retries: 3

  error-generator:
    build:
      context: ./error-generator
      dockerfile: Dockerfile
    environment:
      - SLOGAN_SERVER_URL=http://slogan-server:8080
      - ERROR_INTERVAL_SECONDS=60
      - GIPHY_API_KEY=${GIPHY_API_KEY:-}
    depends_on:
      slogan-server:
        condition: service_healthy
    networks:
      - ec2-test-network

networks:
  ec2-test-network:
    driver: bridge
